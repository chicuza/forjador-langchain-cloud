# ============================================================================
# FORJADOR V5 - SPEC-01 DIMENSION VALIDATION PATTERNS
# ============================================================================
# Version: 1.0.0
# Purpose: Regex patterns for fastener dimension format validation
# Date: 2026-02-09
#
# This YAML file defines comprehensive regex patterns for validating fastener
# dimension formats in both metric and imperial systems. It supports various
# dimension notations used in Brazilian industrial purchase orders and
# international standards.
#
# Pattern Types:
# - Metric: M8, M8x30, M8x1.25x30 (ISO/DIN/ABNT standard)
# - Imperial: #8-32, 1/4"-20, 3/8"-16 (ASME/ANSI standard)
# - Tolerance: M8±0.1, 8.0+0.2/-0.1
#
# Usage: Post-extraction validation to ensure dimension format correctness
# Performance: Compiled regex for fast matching (< 1ms per pattern)
# ============================================================================

metadata:
  version: "1.0.0"
  spec: "SPEC-01"
  total_patterns: 45
  systems: ["metric", "imperial", "tolerance"]
  last_updated: "2026-02-09"

# ============================================================================
# METRIC DIMENSION PATTERNS (ISO/DIN/ABNT)
# ============================================================================

metric_patterns:

  # --------------------------------------------------------------------------
  # Simple Diameter (M8, M10, M12)
  # --------------------------------------------------------------------------
  simple_diameter:
    pattern: "^M\\d+(\\.\\d+)?$"
    description: "Metric thread diameter only - used for nuts, washers, and short references"
    examples:
      valid:
        - "M3"
        - "M4"
        - "M5"
        - "M6"
        - "M8"
        - "M10"
        - "M12"
        - "M16"
        - "M20"
        - "M24"
        - "M30"
        - "M36"
        - "M8.5"      # Uncommon but valid
        - "M10.5"
        - "M12.5"
      invalid:
        - "8"         # Missing M prefix
        - "M"         # No diameter
        - "M 8"       # Space not allowed
        - "m8"        # Lowercase not allowed (normalized to uppercase)
        - "M8x"       # Incomplete pattern

    applicable_to:
      - porca
      - arruela
      - bucha
      - anel_de_trava

  # --------------------------------------------------------------------------
  # Diameter x Length (M8x30, M10x50)
  # --------------------------------------------------------------------------
  diameter_length:
    pattern: "^M\\d+(\\.\\d+)?x\\d+(\\.\\d+)?$"
    description: "Metric diameter x length - most common for bolts and screws"
    examples:
      valid:
        - "M8x30"
        - "M10x50"
        - "M12x100"
        - "M16x150"
        - "M20x200"
        - "M6x25"
        - "M5x16"
        - "M4x12"
        - "M8x35.5"   # Decimal length
        - "M10.5x50"  # Decimal diameter (rare)
      invalid:
        - "M8X30"     # Uppercase X (normalized to lowercase)
        - "M8 x 30"   # Spaces not allowed
        - "8x30"      # Missing M prefix
        - "M8-30"     # Wrong separator

    applicable_to:
      - parafuso
      - prisioneiro
      - chumbador

  # --------------------------------------------------------------------------
  # Full Metric: Diameter x Pitch x Length (M8x1.25x30)
  # --------------------------------------------------------------------------
  full_metric:
    pattern: "^M\\d+(\\.\\d+)?x\\d+(\\.\\d+)?x\\d+(\\.\\d+)?$"
    description: "Complete metric specification with pitch - used for fine thread bolts"
    examples:
      valid:
        - "M8x1.25x30"
        - "M10x1.5x50"
        - "M12x1.75x100"
        - "M16x2.0x150"
        - "M6x1.0x25"
        - "M5x0.8x20"
        - "M4x0.7x16"
        - "M20x2.5x200"
      invalid:
        - "M8x1.25X30"  # Mixed case
        - "M8x1,25x30"  # Comma instead of period
        - "M8x30"       # Missing pitch

    applicable_to:
      - parafuso
      - prisioneiro

    notes: "Pitch is critical for fine thread applications where standard coarse pitch is not used"

  # --------------------------------------------------------------------------
  # Washer Dimensions: Inner x Outer x Thickness (8.4x16x1.6)
  # --------------------------------------------------------------------------
  washer_dimensions:
    pattern: "^\\d+(\\.\\d+)?x\\d+(\\.\\d+)?x\\d+(\\.\\d+)?$"
    description: "Inner diameter x Outer diameter x Thickness - for washers"
    examples:
      valid:
        - "8.4x16x1.6"
        - "10.5x20x2"
        - "12.5x24x2.5"
        - "6.4x12x1.6"
        - "5x10x1"
      invalid:
        - "M8x16x1.6"  # Should not have M prefix for washer dimensions
        - "8x16"       # Missing thickness

    applicable_to:
      - arruela

  # --------------------------------------------------------------------------
  # Pin/Dowel Dimensions: Diameter x Length (6x40)
  # --------------------------------------------------------------------------
  pin_dimensions:
    pattern: "^\\d+(\\.\\d+)?x\\d+(\\.\\d+)?$"
    description: "Diameter x Length - for pins, dowels, and rivets (no M prefix)"
    examples:
      valid:
        - "3x20"
        - "4x25"
        - "5x30"
        - "6x40"
        - "8x50"
        - "10x60"
        - "3.2x8"     # Pop rivet size
        - "4.0x10"
        - "4.8x12"
        - "6.4x16"
      invalid:
        - "M6x40"     # Should not have M prefix
        - "6"         # Missing length

    applicable_to:
      - pino
      - rebite

  # --------------------------------------------------------------------------
  # Size Designation (S6, S8, S10)
  # --------------------------------------------------------------------------
  size_designation:
    pattern: "^S\\d+$"
    description: "Size designation for anchors and wall plugs"
    examples:
      valid:
        - "S6"
        - "S8"
        - "S10"
        - "S12"
        - "S14"
        - "S16"
      invalid:
        - "6"         # Missing S prefix
        - "s8"        # Lowercase (normalized)
        - "S 8"       # Space not allowed

    applicable_to:
      - bucha

  # --------------------------------------------------------------------------
  # Retaining Ring: Shaft/Bore Diameter (15, 20, 25)
  # --------------------------------------------------------------------------
  retaining_ring_size:
    pattern: "^\\d+(\\.\\d+)?$"
    description: "Shaft or bore diameter for retaining rings (simple number)"
    examples:
      valid:
        - "10"
        - "12"
        - "15"
        - "20"
        - "25"
        - "30"
        - "35"
        - "40"
        - "12.5"
      invalid:
        - "M10"       # Should not have prefix
        - "10mm"      # Should not have unit

    applicable_to:
      - anel_de_trava

    notes: "Size refers to the shaft diameter (external ring) or bore diameter (internal ring)"

# ============================================================================
# IMPERIAL DIMENSION PATTERNS (ASME/ANSI)
# ============================================================================

imperial_patterns:

  # --------------------------------------------------------------------------
  # Number Size with TPI: #8-32, #10-24
  # --------------------------------------------------------------------------
  number_tpi:
    pattern: "^#\\d+-\\d+$"
    description: "Imperial screw number size with threads per inch"
    examples:
      valid:
        - "#0-80"
        - "#2-56"
        - "#4-40"
        - "#6-32"
        - "#8-32"
        - "#10-24"
        - "#12-24"
      invalid:
        - "8-32"      # Missing # prefix
        - "#8x32"     # Wrong separator
        - "# 8-32"    # Space not allowed

    applicable_to:
      - parafuso
      - porca

    notes: "Common in electronics and precision equipment"

  # --------------------------------------------------------------------------
  # Fractional Inch with TPI: 1/4"-20, 3/8"-16
  # --------------------------------------------------------------------------
  fractional_tpi:
    pattern: "^\\d+/\\d+\"-\\d+$"
    description: "Imperial fractional inch diameter with threads per inch"
    examples:
      valid:
        - "1/4\"-20"
        - "5/16\"-18"
        - "3/8\"-16"
        - "1/2\"-13"
        - "5/8\"-11"
        - "3/4\"-10"
        - "1\"-8"
      invalid:
        - "1/4-20"    # Missing inch symbol
        - "1/4\"-20\"" # Extra inch symbol
        - "0.25\"-20" # Decimal not fractional

    applicable_to:
      - parafuso
      - porca
      - prisioneiro

  # --------------------------------------------------------------------------
  # Fractional Inch with Length: 1/4"-20x1.5
  # --------------------------------------------------------------------------
  fractional_tpi_length:
    pattern: "^\\d+/\\d+\"-\\d+x\\d+(\\.\\d+)?$"
    description: "Imperial fractional inch with TPI and length"
    examples:
      valid:
        - "1/4\"-20x1"
        - "1/4\"-20x1.5"
        - "3/8\"-16x2"
        - "1/2\"-13x3"
      invalid:
        - "1/4\"-20x1.5\""  # Extra inch symbol on length

    applicable_to:
      - parafuso
      - prisioneiro

  # --------------------------------------------------------------------------
  # Decimal Inch: 0.250"-20
  # --------------------------------------------------------------------------
  decimal_tpi:
    pattern: "^\\d+\\.\\d+\"-\\d+$"
    description: "Imperial decimal inch diameter with threads per inch"
    examples:
      valid:
        - "0.250\"-20"
        - "0.375\"-16"
        - "0.500\"-13"
      invalid:
        - ".250\"-20"   # Missing leading zero

    applicable_to:
      - parafuso
      - porca

# ============================================================================
# TOLERANCE PATTERNS
# ============================================================================

tolerance_patterns:

  # --------------------------------------------------------------------------
  # Symmetric Tolerance: M8±0.1
  # --------------------------------------------------------------------------
  symmetric_tolerance:
    pattern: "^M?\\d+(\\.\\d+)?(±|\\+/-|\\+/-)\\d+(\\.\\d+)?$"
    description: "Dimension with symmetric tolerance (same plus and minus)"
    examples:
      valid:
        - "M8±0.1"
        - "10±0.05"
        - "M12±0.2"
        - "8+/-0.1"
        - "10+/-0.05"
      invalid:
        - "M8 ± 0.1"  # Spaces not allowed
        - "M8+0.1-0.1" # Use asymmetric pattern

    applicable_to:
      - All types (high precision applications)

  # --------------------------------------------------------------------------
  # Asymmetric Tolerance: 8.0+0.2/-0.1
  # --------------------------------------------------------------------------
  asymmetric_tolerance:
    pattern: "^M?\\d+(\\.\\d+)?\\+\\d+(\\.\\d+)?/-\\d+(\\.\\d+)?$"
    description: "Dimension with asymmetric tolerance (different plus and minus)"
    examples:
      valid:
        - "8.0+0.2/-0.1"
        - "M10+0.1/-0.05"
        - "12+0.3/-0.2"
      invalid:
        - "8+0.2-0.1"  # Missing slash before minus
        - "8 +0.2/-0.1" # Space not allowed

    applicable_to:
      - All types (precision machined parts)

  # --------------------------------------------------------------------------
  # Tolerance Class: M8 6H
  # --------------------------------------------------------------------------
  tolerance_class:
    pattern: "^M\\d+(\\.\\d+)?\\s+\\d+[A-Z]$"
    description: "ISO metric thread tolerance class designation"
    examples:
      valid:
        - "M8 6H"     # Internal thread (nut)
        - "M10 6g"    # External thread (bolt)
        - "M12 5H"
        - "M16 7g"
      invalid:
        - "M8-6H"     # Should have space
        - "M86H"      # Missing space

    applicable_to:
      - parafuso
      - porca
      - prisioneiro

    notes: "6H common for nuts, 6g common for bolts"

# ============================================================================
# COMPOSITE PATTERNS (Multiple Dimensions)
# ============================================================================

composite_patterns:

  # --------------------------------------------------------------------------
  # U-Bolt: M8x50x100 (Thread x Width x Height)
  # --------------------------------------------------------------------------
  u_bolt_dimensions:
    pattern: "^M\\d+x\\d+x\\d+$"
    description: "U-bolt dimensions: Thread size x Width x Height"
    examples:
      valid:
        - "M8x50x100"
        - "M10x60x120"
        - "M12x70x140"
      invalid:
        - "8x50x100"  # Missing M prefix

    applicable_to:
      - grampo

  # --------------------------------------------------------------------------
  # Threaded Insert: M6x10 (Thread x Length)
  # --------------------------------------------------------------------------
  insert_dimensions:
    pattern: "^M\\d+x\\d+(\\.\\d+)?$"
    description: "Threaded insert: Internal thread size x Length"
    examples:
      valid:
        - "M4x8"
        - "M5x10"
        - "M6x12"
        - "M8x15"
      invalid:
        - "6x12"      # Missing M prefix

    applicable_to:
      - inserto

# ============================================================================
# VALIDATION RULES
# ============================================================================

validation_rules:
  preprocessing:
    - normalize_case: "uppercase"
    - remove_spaces: true
    - normalize_separators:
        "X": "x"      # Uppercase X to lowercase x
        " x ": "x"    # Spaces around x
        ",": "."      # Comma to period for decimals

  matching_strategy:
    priority: "most_specific_first"  # Try full_metric before diameter_length
    fallback: true                    # If no pattern matches, flag for review

  error_messages:
    invalid_format: "Dimension format does not match any known pattern"
    missing_components: "Dimension missing required components (e.g., diameter, length)"
    invalid_characters: "Dimension contains invalid characters"

# ============================================================================
# COMMON DIMENSION RANGES (For Business Validation)
# ============================================================================

dimension_ranges:
  metric_diameters:
    common: [3, 4, 5, 6, 8, 10, 12, 14, 16, 20, 24, 30, 36]
    min: 1.6
    max: 100
    note: "Diameters outside common range may require verification"

  metric_lengths:
    min: 4
    max: 1000
    typical_range: [10, 16, 20, 25, 30, 35, 40, 50, 60, 70, 80, 100, 120, 150, 200]

  metric_pitches:
    coarse_thread:
      M3: 0.5
      M4: 0.7
      M5: 0.8
      M6: 1.0
      M8: 1.25
      M10: 1.5
      M12: 1.75
      M16: 2.0
      M20: 2.5
      M24: 3.0

    fine_thread:
      M8: 1.0
      M10: 1.25
      M12: 1.5
      M16: 1.5
      M20: 2.0

  imperial_sizes:
    number_sizes: ["#0", "#2", "#4", "#6", "#8", "#10", "#12"]
    fractional_sizes: ["1/4\"", "5/16\"", "3/8\"", "7/16\"", "1/2\"", "5/8\"", "3/4\"", "1\""]

# ============================================================================
# PATTERN TESTING EXAMPLES
# ============================================================================

test_cases:
  metric_valid:
    - "M8"
    - "M10x50"
    - "M12x1.75x100"
    - "8.4x16x1.6"
    - "4.8x12"

  metric_invalid:
    - "8"          # Missing M prefix
    - "M8X30"      # Wrong case (should normalize)
    - "M8 x 30"    # Spaces
    - "M8-30"      # Wrong separator

  imperial_valid:
    - "#8-32"
    - "1/4\"-20"
    - "3/8\"-16x2"

  imperial_invalid:
    - "8-32"       # Missing # prefix
    - "1/4-20"     # Missing inch symbol

  tolerance_valid:
    - "M8±0.1"
    - "10+0.2/-0.1"
    - "M12 6H"

# ============================================================================
# END OF DIMENSION PATTERNS
# ============================================================================
